(this["webpackJsonpyemit-break-frontend"]=this["webpackJsonpyemit-break-frontend"]||[]).push([[0],{106:function(e,t){},108:function(e,t){},127:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(24),i=a.n(s),o=a(17),c=(a(79),a(80),a(81),a(1)),l=a.n(c),u=a(20),m=a(12),d=a(3),h=a(5),p=a(6),f=a(8),g=a(7),v=a(9),b=a(10),y=(a(83),a(84),a(33)),E=a.n(y);a(101);E.a.interceptors.response.use(null,(function(e){return e.response&&e.response.status>=400&&e.response.status<500||(console.error("Unexpected server error:",e),b.b.error("An unexpected server error occurred, pester Mel on Discord!")),Promise.reject(e)}));var k={};function w(){return(w=Object(d.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.get(t,k);case 2:return a=e.sent,n=a.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return(_=Object(d.a)(l.a.mark((function e(t,a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.post(t,a,k);case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(){return(N=Object(d.a)(l.a.mark((function e(t,a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.a.put(t,a,k);case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C={get:function(e){return w.apply(this,arguments)},post:function(e,t){return _.apply(this,arguments)},put:function(e,t){return N.apply(this,arguments)},setJwt:function(e){E.a.defaults.headers.common["x-auth-token"]=e}},O=a(68),x={api:"https://yemit-break.com/api/",base:"https://yemit-break.com/"};function S(){return(S=Object(d.a)(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C.post(x.api+"users",t);case 3:return a=e.sent,localStorage.setItem("token",a.jwt),e.abrupt("return",a);case 8:return e.prev=8,e.t0=e.catch(0),n=e.t0.response.data,b.b.error(n.message),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function j(){return(j=Object(d.a)(l.a.mark((function e(t,a){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C.post(x.api+"users/login",{email:t,password:a});case 3:return n=e.sent,localStorage.setItem("token",n.jwt),e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(0),r=e.t0.response.data,b.b.error(r.message),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function A(){return localStorage.getItem("token")}C.setJwt(A());var T={register:function(e){return S.apply(this,arguments)},login:function(e,t){return j.apply(this,arguments)},logout:function(){localStorage.removeItem("token")},getCurrentUser:function(){try{var e=localStorage.getItem("token");return Object(O.a)(e)}catch(t){return null}},getJwt:A};var P=function(e){var t=e.onToggle;return r.a.createElement("div",{className:"navbar-brand"},r.a.createElement("img",{className:"navbar-item",src:"logo192.png",alt:"The League",width:"65"}),r.a.createElement(o.b,{className:"navbar-item",to:"/all-toons"},"Yemit Break"),r.a.createElement("a",{role:"button",className:"navbar-burger burger","aria-label":"menu","aria-expanded":"false","data-target":"navbarMenu",onClick:t},r.a.createElement("span",{"aria-hidden":"true"}),r.a.createElement("span",{"aria-hidden":"true"}),r.a.createElement("span",{"aria-hidden":"true"})))};var I=function(e){var t,a=e.user,n=e.label,s=e.link,i=e.list,c=e.onClick;switch(n){case"Toons":t="Player";break;case"Fights":default:t="DM"}var l=a&&a.permissions&&a.permissions.includes(t);return r.a.createElement("div",{className:"navbar-item has-dropdown is-hoverable"},r.a.createElement("div",{className:"navbar-link is-arrowless"},n),r.a.createElement("div",{className:"navbar-dropdown"},l&&r.a.createElement(r.a.Fragment,null,r.a.createElement(o.b,{className:"navbar-item",to:s,onClick:c},"Create a new ",n.capitalize().slice(0,-1)),r.a.createElement("hr",{className:"navbar-divider"})),i.map((function(e){return r.a.createElement(o.b,{key:e._id,className:"navbar-item",to:"".concat(s,"/").concat(e._id),onClick:c},e.name)}))))};var M=function(e){var t=e.user,a=e.toons,n=e.fights,s=e.isOpen,i=e.onToggle;return r.a.createElement("div",{className:"navbar-menu ".concat(s?"is-active":""),id:"navbarMenu"},r.a.createElement("div",{className:"navbar-start"},r.a.createElement(o.b,{className:"navbar-item",to:"/all-toons",onClick:i},"All The Toons"),t&&r.a.createElement(I,{user:t,label:"Toons",link:"/my-toon",list:a,onClick:i}),r.a.createElement(I,{user:t,label:"Fights",link:"/fight",list:n,onClick:i})),r.a.createElement("div",{className:"navbar-end"},r.a.createElement("div",{className:"navbar-item"},r.a.createElement("div",{className:"buttons"},!t&&r.a.createElement(o.b,{className:"button is-light",to:"/login",onClick:i},"Login"),!t&&r.a.createElement(o.b,{className:"button is-primary",to:"/register",onClick:i},"Register"),t&&r.a.createElement(o.b,{className:"button is-primary",to:"/logout",onClick:i},"Logout")))))},q=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={burgerIsOpen:!1},e.handleToggle=function(t){e.setState({burgerIsOpen:!e.state.burgerIsOpen})},e.handleClick=function(t){e.setState({burgerIsOpen:!1})},e}return Object(p.a)(a,[{key:"render",value:function(){return r.a.createElement("nav",{className:"navbar has-background-light",role:"navigation","aria-label":"main navigation"},r.a.createElement(P,{onToggle:this.handleToggle}),r.a.createElement(M,{user:this.props.user,toons:this.props.toons,fights:this.props.fights,isOpen:this.state.burgerIsOpen,onToggle:this.handleClick}))}}]),a}(n.Component),H=a(40);var D=function(e){var t=e.name,a=e.value,n=e.list,s=e.options,i=e.onChange,o=e.disabled,c=void 0!==o&&o,l=e.constraint,u=void 0===l?function(e){return!0}:l,m=e.constraintMessage,d=void 0===m?function(e){return null}:m;return s=s||{},r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label",htmlFor:t},s.label||t[0].toUpperCase()+t.slice(1)),r.a.createElement("div",{className:"control"},r.a.createElement("div",{className:"select"},r.a.createElement("select",{value:a,id:t,name:t,onChange:function(e){var t=e.currentTarget;i(t.name,t.value)},disabled:c},r.a.createElement("option",{key:"-1",value:"",disabled:!0},"Pick one..."),n.map((function(e){return r.a.createElement("option",{key:e._id,value:e._id,disabled:!u(e),title:d(e)},e.name)}))))))},F=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={quickAction:"",isValid:!1,target:"",modifier:"",submitting:!1},e.handleActionChange=function(t,a){var n={quickAction:a,target:"",modifier:""};switch(a){case"Cover":case"Inspire":case"Guard":case"Harry":n.isValid=!1;break;case"Pass":case"Parry":default:n.isValid=!0}e.setState(n)},e.handleTargetChange=function(t){var a=t.currentTarget;switch(e.state.quickAction){case"Cover":case"Guard":e.setState({target:a.value,isValid:!0});break;case"Inspire":default:e.setState({target:a.value,isValid:e.state.modifier})}},e.handleModifierChange=function(t,a){switch(e.state.quickAction){case"Inspire":e.setState({modifier:a,isValid:e.state.target});break;case"Harry":default:e.setState({modifier:a,isValid:!0})}},e.renderToonSelect=function(){var t=e.props,a=t.toons,n=t.myToon;return r.a.createElement("div",{className:"control"},r.a.createElement("div",{className:"select"},r.a.createElement("select",{onChange:e.handleTargetChange,value:e.state.target,disabled:n&&n.quickAction},r.a.createElement("option",{value:"",disabled:!0},"Pick one..."),a.filter((function(e){return e._id!==n._id})).map((function(e){return r.a.createElement("option",{key:e._id,value:e._id},e.name)})))))},e.renderWithToons=function(t){return r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},t+":"),e.renderToonSelect())},e.renderInspire=function(){var t=e.props.myToon;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Inspire:"),e.renderToonSelect()),r.a.createElement(D,{name:"to",value:e.state.modifier,list:[{_id:"Attack",name:"Attack"},{_id:"Heal",name:"Heal"}],onChange:e.handleModifierChange,disabled:t&&t.quickAction}))},e.renderHarry=function(){var t=e.props.myToon;return r.a.createElement(D,{name:"with",value:e.state.modifier,list:[{_id:"Smashing",name:"Smashing"},{_id:"Entropy",name:"Entropy"}],onChange:e.handleModifierChange,disabled:t&&t.quickAction})},e.handleSubmit=function(){var t=e.props.myToon;switch(e.setState({submitting:!0}),e.state.quickAction){case"Cover":return{name:"Cover",from:t._id,to:e.state.target};case"Inspire":return{name:"Inspire Offense",from:t._id,to:e.state.target,action:e.state.modifier};case"Guard":return{name:"Inspire Guard",from:t._id,to:e.state.target};case"Harry":return{name:"Harry",from:t._id,with:e.state.modifier};case"Pass":return{name:"Pass",from:t._id};case"Parry":default:return{name:"Parry",from:t._id}}},e.doSubmit=Object(d.a)(l.a.mark((function t(){var a,n,r,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.props.onSubmit,t.prev=1,t.next=4,a(e.handleSubmit());case 4:t.next=11;break;case 6:t.prev=6,t.t0=t.catch(1),n=t.t0.response,r=n.status,s=n.data,400===r&&s.message.includes("cover")?(b.b.error(s.message),e.setState({quickAction:"",isValid:!1,target:"",modifier:"",submitting:!1})):console.error("Unexpected error while posting toon support",t.t0.response);case 11:case"end":return t.stop()}}),t,null,[[1,6]])}))),e}return Object(p.a)(a,[{key:"componentDidUpdate",value:function(e,t,a){t.submitting&&this.props.myToon.quickAction&&this.setState({submitting:!this.props.myToon.quickAction})}},{key:"render",value:function(){var e=this.props.myToon,t=e&&e.quickAction;return r.a.createElement("div",{className:"box"},r.a.createElement("h3",{className:"title is-3"},"".concat(e.name,"'s quick action")),r.a.createElement(D,{name:"action",value:this.state.quickAction,list:[{_id:"Cover",name:"Cover"},{_id:"Inspire",name:"Inspire Action"},{_id:"Guard",name:"Inspire Guard"},{_id:"Parry",name:"Parry"},{_id:"Harry",name:"Harry"},{_id:"Pass",name:"Pass"}],options:{label:"Quick Action"},onChange:this.handleActionChange,disabled:t||e.current_hp<0}),!t&&"Cover"===this.state.quickAction&&this.renderWithToons("Cover"),!t&&"Inspire"===this.state.quickAction&&this.renderInspire(),!t&&"Guard"===this.state.quickAction&&this.renderWithToons("Inspire Guard"),!t&&"Harry"===this.state.quickAction&&this.renderHarry(),r.a.createElement("button",{type:"button",className:"button is-primary ".concat(this.state.submitting?"is-loading":""),disabled:!this.state.isValid||t,onClick:this.doSubmit},"Done"))}}]),a}(n.Component);var U=function(e){var t=e.fight,a=e.myToons,n=t.toonObjects||[],s=function(){var e=Object(d.a)(l.a.mark((function e(a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=x.api+"fights/"+t._id+"/support/",e.t0=a.name,e.next="Cover"===e.t0?4:"Inspire Offense"===e.t0?6:"Inspire Guard"===e.t0?8:"Harry"===e.t0?10:"Pass"===e.t0?12:(e.t0,14);break;case 4:return n+="cover",e.abrupt("break",16);case 6:return n+="inspire",e.abrupt("break",16);case 8:return n+="guard",e.abrupt("break",16);case 10:return n+="harry",e.abrupt("break",16);case 12:return n+="pass",e.abrupt("break",16);case 14:return n+="parry",e.abrupt("break",16);case 16:return e.prev=16,e.next=19,C.post(n,a);case 19:e.next=24;break;case 21:throw e.prev=21,e.t1=e.catch(16),e.t1;case 24:case"end":return e.stop()}}),e,null,[[16,21]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,a.map((function(e){return r.a.createElement(F,{key:e._id,toons:n,myToon:e,onSubmit:s})})))};var L=function(e){var t=e.name,a=e.value,n=e.list,s=e.options,i=e.onChange,o=e.constraint,c=void 0===o?function(e){return!0}:o,l=e.constraintMessage,u=void 0===l?function(e){return null}:l;return s=s||{},r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label",htmlFor:t},s&&s.label||t[0].toUpperCase()+t.slice(1)),r.a.createElement("div",{className:"control"},r.a.createElement("div",{className:"select is-multiple"},r.a.createElement("select",{id:t,name:t,multiple:!0,value:a,onChange:function(e){var a=e.currentTarget,n=Array.prototype.slice.call(a.selectedOptions).map((function(e){return e.value}));i(t,n)}},n.map((function(e){return r.a.createElement("option",{key:e._id,value:e._id,disabled:!c(e),title:u(e)},e.name)}))))))},R=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={caps:!1},e.checkChange=function(t){"password"===e.props.type&&e.setState({caps:t.getModifierState("CapsLock")})},e}return Object(p.a)(a,[{key:"renderIcons",value:function(){return"password"===this.props.type?r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fas fa-lock"})):"email"===this.props.name?r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fas fa-envelope"})):"name"===this.props.name?r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fas fa-id-card"})):"roll"===this.props.name?r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fas fa-dice-two"})):"buster"===this.props.name?r.a.createElement("span",{className:"icon is-small is-left"},r.a.createElement("i",{className:"fas fa-hammer"})):null}},{key:"render",value:function(){var e=this.props,t=e.type,a=e.name,n=e.value,s=e.onChange,i=e.options,o=e.error,c=e.disabled;return i=i||{},r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label",htmlFor:a},i.label||a[0].toUpperCase()+a.slice(1)),r.a.createElement("div",{className:"control has-icons-left"},r.a.createElement("input",{type:t,className:"input",id:a,name:a,value:n,onKeyPress:this.checkChange,onChange:function(e){var t=e.currentTarget;s(t.name,t.value)},placeholder:i.placeholder||"",disabled:!!c}),this.renderIcons()),this.state.caps&&r.a.createElement("p",{className:"help has-text-warning-dark has-background-warning"},'"CAPS lock is on!"'),o&&r.a.createElement("p",{className:"help is-danger"},o))}}]),a}(n.Component),V=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={action:"",isValid:!1,target:[],modifier:"",roll:0,submitting:!1},e.handleActionChange=function(t,a){var n={action:a,target:[],roll:0,modifier:""};switch(a){case"Attack":case"Heal":case"Precise Attack":n.isValid=!1;break;case"Pass":default:n.isValid=!0}e.setState(n)},e.handleTargetChange=function(t,a){switch(e.state.action){case"Heal":e.setState({target:a,isValid:a&&a.length&&Number.isInteger(e.state.roll)});break;case"Attack":e.setState({target:a,isValid:a&&a.length&&Number.isInteger(e.state.roll)&&e.state.modifier});break;case"Precise Attack":e.setState({target:a,isValid:a&&a.length&&e.state.modifier});break;case"Pass":default:e.setState({target:a,isValid:!0})}},e.handleRollChange=function(t,a){switch(a=Math.max(Math.min(a,1e3),0),e.state.action){case"Heal":e.setState({roll:a,isValid:Number.isInteger(a)&&e.state.target&&e.state.target.length});break;case"Attack":e.setState({roll:a,isValid:Number.isInteger(a)&&e.state.target&&e.state.target.length&&e.state.modifier});break;default:e.setState({roll:a,isValid:!0})}},e.handleModifierChange=function(t,a){switch(e.state.action){case"Attack":case"Heal":e.setState({modifier:a,isValid:Number.isInteger(e.state.roll)&&e.state.target&&e.state.target.length});break;case"Precise Attack":default:e.setState({modifier:a,isValid:e.state.target&&e.state.target.length})}},e.renderHeal=function(){var t=e.props.toons;return r.a.createElement(r.a.Fragment,null,r.a.createElement(L,{name:"targets",value:e.state.target,list:t,options:{label:"Healing:"},onChange:e.handleTargetChange}),r.a.createElement(R,{type:"number",name:"roll",value:e.state.roll,onChange:e.handleRollChange,error:null}))},e.renderEnemyTargetSelect=function(t){return r.a.createElement(L,{name:"targets",value:e.state.target,list:t,options:{label:e.state.action},onChange:e.handleTargetChange,constraint:function(e){return e.current_hp>0},constraintMessage:function(e){return e.current_hp>0?null:e.name+"'s dead!"}})},e.renderAttack=function(){var t=e.props.enemies;return r.a.createElement(r.a.Fragment,null,e.renderEnemyTargetSelect(t),r.a.createElement(D,{name:"modifier",value:e.state.modifier,list:[{_id:"Smashing",name:"Smashing"},{_id:"Entropy",name:"Entropy"}],options:{label:"With:"},onChange:e.handleModifierChange}),r.a.createElement(R,{type:"number",name:"roll",value:e.state.roll,onChange:e.handleRollChange,error:null}))},e.renderPreciseAttack=function(){var t=e.props.enemies;return r.a.createElement(r.a.Fragment,null,e.renderEnemyTargetSelect(t),r.a.createElement(D,{name:"modifier",value:e.state.modifier,list:[{_id:"Smashing",name:"Smashing"},{_id:"Entropy",name:"Entropy"}],options:{label:"With:"},onChange:e.handleModifierChange}))},e.handleSubmit=function(){var t=e.props.myToon;switch(e.setState({submitting:!0}),e.state.action){case"Attack":return{name:"Attack",from:t._id,to:e.state.target,roll:e.state.roll,with:e.state.modifier};case"Precise Attack":return{name:"Precise Attack",from:t._id,to:e.state.target};case"Heal":return{name:"Heal",from:t._id,to:e.state.target,roll:e.state.roll};default:return{name:"Pass",from:t._id}}},e}return Object(p.a)(a,[{key:"componentDidUpdate",value:function(e,t,a){t.submitting&&this.props.myToon.action&&this.setState({submitting:!this.props.myToon.action})}},{key:"render",value:function(){var e=this,t=this.props,a=t.myToon,n=t.onSubmit,s=a&&a.action;return r.a.createElement("div",{className:"box"},r.a.createElement("h3",{className:"title is-3"},"".concat(a.name,"'s action")),r.a.createElement(D,{name:"action",value:this.state.action,list:[{_id:"Attack",name:"Attack"},{_id:"Precise Attack",name:"Precise Attack"},{_id:"Heal",name:"Heal"},{_id:"Pass",name:"Pass"}],onChange:this.handleActionChange,disabled:s||a.current_hp<0,constraint:function(e){return"Harry"!==a.quickAction&&"Parry"!==a.quickAction&&"Cover"!==a.quickAction||"Precise Attack"===e.name},constraintMessage:function(e){return"Only wit-based attacks allowed when covering, parrying or harrying"}}),!s&&"Attack"===this.state.action&&this.renderAttack(),!s&&"Precise Attack"===this.state.action&&this.renderPreciseAttack(),!s&&"Heal"===this.state.action&&this.renderHeal(),r.a.createElement("button",{type:"button",className:"button is-primary ".concat(this.state.submitting?"is-loading":""),disabled:!this.state.isValid||s,onClick:function(){n(e.handleSubmit())}},"Done"))}}]),a}(n.Component);var B=function(e){var t=e.fight,a=e.myToons,n=t.toonObjects||[],s=function(){var e=Object(d.a)(l.a.mark((function e(a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=x.api+"fights/"+t._id+"/offense/",e.t0=a.name,e.next="Attack"===e.t0?4:"Heal"===e.t0?6:"Precise Attack"===e.t0?8:10;break;case 4:return n+="attack",e.abrupt("break",12);case 6:return n+="heal",e.abrupt("break",12);case 8:return n+="precise",e.abrupt("break",12);case 10:return n+="pass",e.abrupt("break",12);case 12:return e.prev=12,e.next=15,C.post(n,a);case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(12),console.error("Unexpected error while posting toon action:",e.t1);case 20:case"end":return e.stop()}}),e,null,[[12,17]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,a.map((function(e){return r.a.createElement(V,{key:e._id,toons:n,myToon:e,enemies:t&&t.enemies,onSubmit:s})})))},G=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={roll:0,submitting:!1},e.handleSubmit=function(){var t=e.props.attack;return e.setState({submitting:!0}),{name:"Resolve",from:t.to,to:t._id,roll:e.state.roll}},e.handleRollChange=function(t,a){a=Math.max(Math.min(a,1e3),0),e.setState({roll:a})},e}return Object(p.a)(a,[{key:"componentDidUpdate",value:function(e,t,a){t.submitting&&this.setState({submitting:!this.props.attack})}},{key:"render",value:function(){var e=this,t=this.props,a=t.attack,n=t.onSubmit;return r.a.createElement("div",{className:"box"},r.a.createElement("h3",{className:"title is-3"},"".concat(a.toon.name,": defend against ").concat(a.enemy.name,"!")),r.a.createElement(R,{type:"number",name:"roll",value:this.state.roll,onChange:this.handleRollChange,error:null,disabled:a.toon.current_hp<0}),r.a.createElement("button",{type:"button",className:"button is-primary ".concat(this.state.submitting?"is-loading":""),disabled:!Number.isInteger(this.state.roll),onClick:function(){n(e.handleSubmit())}},"Done"))}}]),a}(n.Component),J=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={action:"",target:[],roll:0,modifier:0,submitting:!1},e.handleActionChange=function(t,a){e.setState({action:a,target:[],roll:0,modifier:0})},e.handleSubmit=function(){var t=e.props.enemy;switch(e.setState({submitting:!0}),e.state.action){case"Attack":return{name:"Mob Attack",from:t._id,to:e.state.target,roll:e.state.roll};default:return{name:"Tank Buster",from:t._id,to:e.state.target,roll:e.state.roll,tankBusterBonus:e.state.modifier}}},e.handleTargetChange=function(t,a){var n;n="Attack"===e.state.action?a&&a.length&&Number.isInteger(e.state.roll):a&&a.length&&Number.isInteger(e.state.roll)&&e.state.modifier,e.setState({target:a,isValid:n})},e.handleRollChange=function(t,a){var n;a=Math.max(Math.min(a,1e3),0),n="Attack"===e.state.action?Number.isInteger(a)&&e.state.target&&e.state.target.length:Number.isInteger(a)&&e.state.target&&e.state.target.length&&e.state.modifier,e.setState({roll:a,isValid:n})},e.handleBusterChange=function(t,a){var n=Math.max(a,0);e.setState({modifier:n,isValid:n&&e.state.target&&e.state.target.length&&Number.isInteger(e.state.roll)})},e.renderAttack=function(){var t=e.props.toons;return r.a.createElement(r.a.Fragment,null,r.a.createElement(L,{name:"targets",value:e.state.target,list:t,options:{label:"Attack:"},onChange:e.handleTargetChange}),r.a.createElement(R,{type:"number",name:"roll",value:e.state.roll,onChange:e.handleRollChange,error:null}))},e.renderTankBuster=function(){var t=e.props.toons;return r.a.createElement(r.a.Fragment,null,r.a.createElement(L,{name:"targets",value:e.state.target,list:t,options:{label:"Attack:"},onChange:e.handleTargetChange}),r.a.createElement(R,{type:"number",name:"roll",value:e.state.roll,onChange:e.handleRollChange,error:null}),r.a.createElement(R,{type:"number",name:"buster",value:e.state.modifier,options:{label:"Buster Bonus:"},onChange:e.handleBusterChange,error:null}))},e}return Object(p.a)(a,[{key:"componentDidUpdate",value:function(e,t,a){t.submitting&&this.props.enemy.action&&this.setState({submitting:!this.props.enemy.action})}},{key:"render",value:function(){var e=this,t=this.props,a=t.enemy,n=t.onSubmit,s=a&&a.action;return a.current_hp<1?null:r.a.createElement("div",{className:"box"},r.a.createElement("h3",{className:"title is-3"},"".concat(a.name,"'s action")),r.a.createElement(D,{name:"action",value:this.state.action,list:[{_id:"Attack",name:"Attack"},{_id:"Tank Buster",name:"Tank Buster"}],options:{label:"Action:"},onChange:this.handleActionChange,disabled:s}),!s&&"Attack"===this.state.action&&this.renderAttack(),!s&&"Tank Buster"===this.state.action&&this.renderTankBuster(),r.a.createElement("button",{type:"button",className:"button is-primary ".concat(this.state.submitting?"is-loading":""),disabled:!this.state.isValid||s,onClick:function(){n(e.handleSubmit())}},"Done"))}}]),a}(n.Component);var W=function(e){var t=e.fight,a=e.myToons,n=e.user,s=t.toonObjects||[],i=a.map((function(e){return e._id})),o=t&&t.attacks?t.attacks.filter((function(e){return i.includes(e.to)})):[],c=n&&n.permissions&&n.permissions.includes("DM"),u=function(){var e=Object(d.a)(l.a.mark((function e(a){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=x.api+"fights/"+t._id+"/defense/",e.t0=a.name,e.next="Mob Attack"===e.t0?4:"Tank Buster"===e.t0?6:8;break;case 4:return n+="mob-attack",e.abrupt("break",10);case 6:return n+="mob-tank-buster",e.abrupt("break",10);case 8:return n+="resolve",e.abrupt("break",10);case 10:return e.prev=10,console.log("Posting",a,"to",n),e.next=14,C.post(n,a);case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(10),console.error("Unexpected error while posting mob action:",e.t1);case 19:case"end":return e.stop()}}),e,null,[[10,16]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,o.map((function(e){return r.a.createElement(G,{key:e._id,attack:e,onSubmit:u})})),c&&t&&t.enemies&&t.enemies.map((function(e){return r.a.createElement(J,{key:e._id,enemy:e,toons:s,onSubmit:u})})))};var z=function(e){var t=e.user,a=e.fight,n=(a.toonObjects||[]).filter((function(e){return!!t&&e.user===t._id}));switch(a.phase){case"Support":return r.a.createElement(U,{myToons:n,fight:a});case"Action":return r.a.createElement(B,{myToons:n,fight:a});case"Defense":default:return r.a.createElement(W,{user:t,myToons:n,fight:a})}},Y=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={listening:!1,log:[]},e}return Object(p.a)(a,[{key:"updateLog",value:function(e){try{var t=JSON.parse(e.data),a=[{ts:new Date(Date.now()),msg:t.msg}].concat(Object(m.a)(this.state.log));a.sortWithFunction((function(e,t){return e.ts<t.ts}),"descending"),this.setState({log:a}),console.log("Combat log just received an update:",t)}catch(n){console.error("Error trying to decode combat log data",n)}}},{key:"componentDidMount",value:function(){this.props.stream&&!this.state.listening&&(this.setState({listening:!0}),this.props.stream.addEventListener("action-taken",this.updateLog.bind(this)),this.props.stream.addEventListener("mob-acted",this.updateLog.bind(this)))}},{key:"componentDidUpdate",value:function(e,t,a){this.props.stream&&!this.state.listening&&(this.setState({listening:!0}),this.props.stream.addEventListener("action-taken",this.updateLog.bind(this)),this.props.stream.addEventListener("mob-acted",this.updateLog.bind(this)))}},{key:"formatTime",value:function(e){var t=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0"),n=String(e.getSeconds()).padStart(2,"0");return"".concat(t,":").concat(a,":").concat(n)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"table-container"},r.a.createElement("table",{className:"table is-striped is-fullwidth"},r.a.createElement("tbody",{style:{display:"block",height:"200px",overflowY:"scroll"}},this.state.log.map((function(t){return r.a.createElement("tr",{key:t.ts},r.a.createElement("td",null,e.formatTime(t.ts)),r.a.createElement("td",null,t.msg))})))))}}]),a}(n.Component);var $=function(e){var t=e.toons,a=e.statuses,n=e.attacks,s=[];if(a&&a.is_covering){var i=t.find((function(e){return e._id===a.covering}));s.push(r.a.createElement("p",{key:s.length+1},"Covering ".concat(i.name)))}if(a&&a.is_covered){var o=t.find((function(e){return e._id===a.covered_by}));s.push(r.a.createElement("p",{key:s.length+1},"Covered by ".concat(o.name)))}if(a&&a.is_harrying&&s.push(r.a.createElement("p",{key:s.length+1},"Harrying with ".concat(a.harrying_with))),a&&a.is_inspiring){var c=t.find((function(e){return e._id===a.inspiring}));s.push(r.a.createElement("p",{key:s.length+1},"Inspiring ".concat(c.name," to ").concat(a.inspiring_to)))}if(a&&a.is_inspired){var l,m=Object(u.a)(a.inspired);try{var d=function(){var e=l.value,a=t.find((function(t){return t._id===e.by}));s.push(r.a.createElement("p",{key:s.length+1},"Inspired by ".concat(a.name," to ").concat(e.to)))};for(m.s();!(l=m.n()).done;)d()}catch(E){m.e(E)}finally{m.f()}}if(a&&a.is_guarding){var h=t.find((function(e){return e._id===a.guarding}));s.push(r.a.createElement("p",{key:s.length+1},"Inspiring ".concat(h.name," to Guard")))}if(a&&a.is_guarded){var p,f=Object(u.a)(a.guarded_by);try{var g=function(){var e=p.value,a=t.find((function(t){return t._id===e}));s.push(r.a.createElement("p",{key:s.length+1},"Inspired by ".concat(a.name," to Guard")))};for(f.s();!(p=f.n()).done;)g()}catch(E){f.e(E)}finally{f.f()}}if(a&&a.is_parrying&&s.push(r.a.createElement("p",{key:s.length+1},"Parrying")),n&&n.length>0){var v,b=Object(u.a)(n);try{for(b.s();!(v=b.n()).done;){var y=v.value;s.push(r.a.createElement("p",{key:s.length+1},"Attacked by ".concat(y.enemy.name)))}}catch(E){b.e(E)}finally{b.f()}}return r.a.createElement("div",{className:"has-text-info"},s.map((function(e){return e})))};var Z=function(e){var t=e.toon,a=e.phase,n=e.toons,s=e.attacks,i=t.armor,o=t.main_hand,c=t.off_hand,l=t.trait,u=40+i.hp+o.hp+c.hp+l.hp,m=!1,d=s?s.filter((function(e){return e.to===t._id})):null;switch(a){case"Support":m=null!==t.quickAction;break;case"Action":m=null!==t.action;break;case"Defense":m=null===d||0===d.length}return r.a.createElement("div",{className:"columns is-multiline my-3"},r.a.createElement("div",{className:"column is-2 py-0"},function(e){return e?r.a.createElement("span",{className:"icon is-small is-left",style:{color:"green"}},r.a.createElement("i",{className:"fas fa-check"})):r.a.createElement("span",{className:"icon is-small is-left",style:{color:"red"}},r.a.createElement("i",{className:"fas fa-exclamation"}))}(m)),r.a.createElement("div",{className:"column is-8 py-0"},t.name),r.a.createElement("div",{className:"column is-2 py-0"},"".concat(t.current_hp,"/").concat(u)),r.a.createElement("div",{className:"column is-10 is-offset-2 py-0"},r.a.createElement($,{toons:n,statuses:t.statuses,attacks:d})))};var K=function(e){var t=e.toons,a=e.phase,n=e.attacks;return t=t||[],r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",{className:"title is-3"},"Us"),t.map((function(e){return r.a.createElement(Z,{key:e._id,toon:e,phase:a,toons:t,attacks:n})})))};var Q=function(e){var t=e.attacks;return r.a.createElement(r.a.Fragment,null,t.map((function(e){return r.a.createElement("p",{key:e._id},"[".concat(e.roll,"+").concat(e.bonus,"] to ").concat(e.toon.name))})))};var X=function(e){var t=e.enemy,a=e.phase,n=e.attacks,s=e.isDm;return r.a.createElement("div",{className:"columns is-multiline my-3"},r.a.createElement("div",{className:"column is-2 py-0"},"Defense"!==a||t.action?r.a.createElement("span",{className:"icon is-small is-left",style:{color:"green"}},r.a.createElement("i",{className:"fas fa-check"})):r.a.createElement("span",{className:"icon is-small is-left",style:{color:"red"}},r.a.createElement("i",{className:"fas fa-exclamation"}))),r.a.createElement("div",{className:"column is-7 py-0"},t.name),r.a.createElement("div",{className:"column is-1 py-0"},function(e){return e.current_hp>0?null:r.a.createElement("span",{className:"icon is-small is-left",style:{color:"black"}},r.a.createElement("i",{className:"fas fa-skull-crossbones"}))}(t)),s&&r.a.createElement("div",{className:"column is-2 py-0"},"".concat(t.current_hp,"/").concat(t.hp)),r.a.createElement("div",{className:"column is-10 is-offset-2 py-0"},r.a.createElement(Q,{attacks:n})))};var ee=function(e){var t=e.enemies,a=e.phase,n=e.attacks,s=e.user;return t=t||[],n=n||[],r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",{className:"title is-3"},"Them"),t.map((function(e){return r.a.createElement(X,{key:e._id,enemy:e,phase:a,attacks:n.filter((function(t){return t.from===e._id})),isDm:s&&s.permissions&&s.permissions.includes("DM")})})))};var te=function(e){var t=e.fight,a=e.user,n=t.toonObjects,s=t.enemies,i=t.attacks;return r.a.createElement("div",{className:"columns"},r.a.createElement("div",{className:"column has-background-success-light"},r.a.createElement(K,{toons:n,phase:t.phase,attacks:i})),r.a.createElement("div",{className:"column has-background-danger-light"},r.a.createElement(ee,{enemies:s,toons:n,phase:t.phase,attacks:i,user:a})))};var ae=function(e){var t=e.name,a=e.round,n=e.phase,s=e.user,i=e.onAdvance,o=e.advancing,c=e.onDelete,l=e.deleting;return r.a.createElement("div",{className:"columns mt-1"},r.a.createElement("div",{className:"column is-three-quarters"},r.a.createElement("h1",{className:"title is-1"},t),r.a.createElement("h2",{className:"title"},"Round ".concat(a," - ").concat(n))),r.a.createElement("div",{className:"column"},s&&s.permissions&&s.permissions.includes("DM")&&r.a.createElement("button",{type:"button",onClick:i,className:"button is-warning ".concat(o?"is-loading":""),disabled:o},"Next phase")),r.a.createElement("div",{className:"column"},s&&s.permissions&&s.permissions.includes("DM")&&r.a.createElement("button",{type:"button",onClick:c,className:"button is-danger ".concat(l?"is-loading":""),disabled:l},"Delete")))};var ne=function(e){var t=e.stream,a=e.match,s=e.fights,i=e.toons,o=e.user,c=e.history,m=Object(n.useState)(!1),h=Object(H.a)(m,2),p=h[0],f=h[1],g=Object(n.useState)(!1),v=Object(H.a)(g,2),y=v[0],E=v[1],k=Object(n.useState)(!1),w=Object(H.a)(k,2),_=w[0],N=w[1],O=s.find((function(e){return e._id===a.params.id}))||{};Object(n.useEffect)((function(){!_&&t&&(N(!0),t.addEventListener("fight-advance",(function(e){try{var t=JSON.parse(e.data).fight;if(O._id===t._id){b.b.info("Now on Round#".concat(t.round," - ").concat(t.phase));var a=new Audio(x.base+"bongos.ogg");a.type="audio/ogg",a.play()}}catch(e){console.error("Unexpected error while parsing advancing fight data:",e)}})),t.addEventListener("fight-delete",(function(e){try{JSON.parse(e.data).deleted===a.params.id&&(b.b.warn("A DM just concluded this fight. You have been automatically redirected."),c.replace("/"))}catch(e){console.error("Unexpected error while parsing deleted fight data:",e)}})))}));var S=function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),t=s.find((function(e){return e._id===a.params.id}))||{},e.prev=2,e.next=5,C.post(x.api+"fights/".concat(t._id,"/next"));case 5:e.sent,f(!1),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),b.b.error("Oh noes! Can't advance to next phase! Bug Mel on Discord!"),console.error("Unexpected error while advancing phases:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm("Delete this fight?")){e.next=16;break}return E(!0),t=s.find((function(e){return e._id===a.params.id}))||{},e.prev=3,e.next=6,C.post(x.api+"fights/".concat(t._id,"/delete"));case 6:e.sent,c.replace("/"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),b.b.error("Oh noes! Can't delete the fight! Bug Mel on Discord!"),console.error("Unexpected error while deleting fight:",e.t0);case 14:e.next=17;break;case 16:console.log("do nothing");case 17:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}(),A=O.toons,T=O.enemies,P=O.round,I=O.phase,M=O.name,q=[],D=A||[];if(i&&(q=i.filter((function(e){return D.includes(e._id)}))),O.toonObjects=q,O&&O.attacks){var F,U=Object(u.a)(O.attacks);try{var L=function(){var e=F.value,t=q.find((function(t){return t._id===e.to})),a=T.find((function(t){return t._id===e.from}));e.toon=t,e.enemy=a};for(U.s();!(F=U.n()).done;)L()}catch(R){U.e(R)}finally{U.f()}}return r.a.createElement(r.a.Fragment,null,r.a.createElement(ae,{name:M,round:P,phase:I,user:o,onAdvance:S,onDelete:j,advancing:p,deleting:y}),r.a.createElement(te,{fight:O,user:o}),r.a.createElement(z,{user:o,fight:O}),r.a.createElement(Y,{stream:t}))},re=a(70),se=a(4),ie=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={data:{},errors:{}},e.validate=function(){return e.schema.validate(e.state.data,{abortEarly:!1}).then((function(e){return{}})).catch((function(e){var t,a={},n=Object(u.a)(e.inner);try{for(n.s();!(t=n.n()).done;){var r=t.value;a[r.path]=r.message}}catch(s){n.e(s)}finally{n.f()}return a}))},e.validateProperty=function(t,a){return se.d(e.schema,t).validate(a).then((function(e){return null})).catch((function(e){var t=/\[\d+\]/,a=e.message;return e.path&&e.path.match(t)&&!e.message.match(t)&&(a=e.path+" "+e.message),a}))},e.handleSubmit=function(){var t=Object(d.a)(l.a.mark((function t(a){var n;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),t.next=3,e.validate();case 3:if(n=t.sent,e.setState({errors:n}),0!==Object.keys(e.state.errors).length){t.next=8;break}return t.next=8,e.doSubmit();case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleChange=function(){var t=Object(d.a)(l.a.mark((function t(a,n){var r,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=Object(re.a)({},e.state)).data[a]=n,t.next=4,e.validateProperty(a,n);case 4:(s=t.sent)?r.errors[a]=s:delete r.errors[a],e.setState(r);case 7:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),e}return Object(p.a)(a,[{key:"render",value:function(){return r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement("h1",{className:"title is-1"},this.state.title),this.renderBody(),r.a.createElement("button",{type:"submit",className:"button is-primary",disabled:Object.keys(this.state.errors).length>0},this.state.buttonLabel))}}]),a}(n.Component),oe=a(21),ce=a(38);var le=function(e){var t=e.index,a=e.enemy,n=e.error,s=e.onChange,i=e.onRemove;return r.a.createElement("div",{className:"box columns is-vcentered"},r.a.createElement("div",{className:"column"},r.a.createElement(R,{type:"text",name:"name",value:a.name,onChange:function(e,a){s(e,a,t)},error:n&&n.name})),r.a.createElement("div",{className:"column"},r.a.createElement(R,{type:"number",name:"dc",value:a.dc,options:{label:"DC"},onChange:function(e,a){s(e,a,t)},error:n&&n.dc})),r.a.createElement("div",{className:"column"},r.a.createElement(R,{type:"number",name:"ab",value:a.ab,options:{label:"AB"},onChange:function(e,a){s(e,a,t)},error:n&&n.ab})),r.a.createElement("div",{className:"column"},r.a.createElement(R,{type:"number",name:"hp",value:a.hp,options:{label:"HP"},onChange:function(e,a){s(e,a,t)},error:n&&n.hp})),r.a.createElement("div",{className:"column"},t>0&&r.a.createElement("button",{type:"button",className:"button is-danger",onClick:function(){console.log("Going to call remove for index",t),i(t)}},"Remove")))};var ue=function(e){var t=e.enemies,a=e.onChange,n=e.errors,s=n&&n.match(/^\[(\d+)\]\.(\w+)\s(.+)$/),i=parseInt(s&&s[1],10),o=s&&s[2],c=s&&s[3],l=t.map((function(e,t){return{enemy:e,error:i===t?Object(ce.a)({},o,c):null,index:t}})),u=function(e,n,r){var s=Object(m.a)(t);s[r][e]=n,a("enemies",s)},d=function(e){var n=Object(m.a)(t);n.splice(e,1),a("enemies",n)};return r.a.createElement(r.a.Fragment,null,l.map((function(e){var t=e.index,a=e.enemy,n=e.error;return r.a.createElement(le,{key:t,index:t,enemy:a,error:n,onChange:u,onRemove:d})})),r.a.createElement("div",{className:"field"},r.a.createElement("button",{type:"button",className:"button is-primary",onClick:function(){var e=Object(m.a)(t);e.push({name:"",dc:0,ab:0,hp:1}),a("enemies",e)}},"Add an enemy")))},me=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={title:"Fight",buttonLabel:"Create",data:{name:"",toons:[],enemies:[{name:"",dc:0,ab:0,hp:0}]},toons:[],errors:{name:"",enemies:"",toons:""}},e.schema=se.c().shape({name:se.e().required().matches(new RegExp(oe.regexes.fight),"Can only contain letters, digits, space, parentheses and -_'"),toons:se.a().of(se.e()).required(),enemies:se.a().of(se.c().shape({name:se.e().matches(new RegExp(oe.regexes.toon),"Can only contain letters, digits or the characters -_' and must be 3 to 50 characters long").required(),dc:se.b().integer().required(),ab:se.b().integer().required(),hp:se.b().positive().integer().required()})).required()}),e}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C.get(x.api+"toons");case 3:t=e.sent,this.setState({toons:t}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Unexpected error while fetching toon list in fight creator",e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"doSubmit",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.post(x.api+"fights",this.state.data);case 2:t=e.sent,b.b.success("Fight created!"),this.props.history.replace("/fight/"+t._id);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderBody",value:function(){var e=this.state,t=e.data,a=e.errors;return r.a.createElement(r.a.Fragment,null,r.a.createElement(R,{type:"text",name:"name",value:t.title,onChange:this.handleChange,error:a.name}),r.a.createElement(L,{name:"toons",options:{label:"Participating toons"},value:t.toons,list:this.state.toons,onChange:this.handleChange,error:a.toons}),r.a.createElement("div",{style:{height:"10rem"}}),r.a.createElement(ue,{onChange:this.handleChange,enemies:t.enemies,errors:a.enemies}))}}]),a}(ie),de=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={title:"Register",buttonLabel:"Register",data:{email:"",password:"",password_confirmation:""},errors:{email:"",password:"",password_confirmation:""}},e.schema=se.c({email:se.e().email().required().label("Email"),password:se.e().matches(new RegExp(oe.regexes.password),"Password must be between 5 and 25 characters").label("Password"),password_confirmation:se.e().required().label("Password Confirmation")}),e.validateProperty=function(t,a){return"password_confirmation"===t?Promise.resolve(a===e.state.data.password?null:"Passwords must match"):se.d(e.schema,t).validate(a).then((function(e){return null})).catch((function(e){return e.message}))},e}return Object(p.a)(a,[{key:"doSubmit",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.register(this.state.data);case 2:e.sent&&(window.location="/");case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderBody",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(R,{type:"text",name:"email",value:this.state.data.email,onChange:this.handleChange,options:{placeholder:"your.email@gmail.com"},error:this.state.errors.email}),r.a.createElement(R,{type:"password",name:"password",value:this.state.data.password,onChange:this.handleChange,options:{placeholder:"*****"},error:this.state.errors.password}),r.a.createElement(R,{type:"password",name:"password_confirmation",value:this.state.data.password_confirmation,onChange:this.handleChange,options:{placeholder:"*****",label:"Confirm Password"},error:this.state.errors.password_confirmation}))}}]),a}(ie),he=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={title:"Login",buttonLabel:"Login",data:{email:"",password:""},errors:{email:"",password:""}},e.schema=se.c().shape({email:se.e().email().required().label("Email"),password:se.e().matches(new RegExp(oe.regexes.password),"Password must be between 5 and 25 characters").label("Password")}),e}return Object(p.a)(a,[{key:"doSubmit",value:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T.login(this.state.data.email,this.state.data.password);case 2:e.sent&&(window.location="/");case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderBody",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(R,{type:"text",name:"email",value:this.state.data.email,onChange:this.handleChange,options:{placeholder:"your.email@gmail.com"},error:this.state.errors.email}),r.a.createElement(R,{type:"password",name:"password",value:this.state.data.password,onChange:this.handleChange,options:{placeholder:"*****"},error:this.state.errors.password}))}}]),a}(ie),pe=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){return Object(h.a)(this,a),t.apply(this,arguments)}return Object(p.a)(a,[{key:"componentDidMount",value:function(){T.logout(),window.location="/"}},{key:"render",value:function(){return null}}]),a}(n.Component);var fe=function(e){var t=e.name,a=e.value,n=e.onChange,s=e.max,i=e.options;return i=i||{},r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label",htmlFor:t},i.label||t[0].toUpperCase()+t.slice(1)),r.a.createElement("div",{className:"field has-addons"},r.a.createElement("div",{className:"control"},r.a.createElement("button",{type:"button",name:t,className:"button is-primary",disabled:0===a,onClick:function(e){var t=e.currentTarget;n(t.name,a-1)}},"-")),r.a.createElement("div",{className:"control"},r.a.createElement("input",{type:"text",id:t,name:t,className:"input",value:a,readOnly:!0})),r.a.createElement("div",{className:"control"},r.a.createElement("button",{type:"button",name:t,className:"button is-primary",disabled:4===a||6===s,onClick:function(e){var t=e.currentTarget;n(t.name,a+1)}},"+"))))};var ge=function(e){e._id;var t=e.name,a=e.gender,n=e.race,s=e.physical,i=e.magical,o=e.leadership,c=e.trait,l=e.armor,u=e.main_hand,m=e.off_hand,d=e.current_hp,h={Smashing:100*s+u.smashing+m.smashing+c.smashing,Dodging:100*s+l.dodging+u.dodging+m.dodging+c.dodging,Entropy:100*i+u.entropy+m.entropy+c.entropy,Harmony:100*i+u.harmony+m.harmony+c.harmony,Moxie:100*o+u.moxie+m.moxie+c.moxie,Wit:100*o+c.wit},p=40+l.hp+u.hp+m.hp+c.hp;return r.a.createElement("div",{className:"card m-2",style:{width:"18rem",float:"left"}},r.a.createElement("div",{className:"card-image"},r.a.createElement("figure",{className:"image"},r.a.createElement("img",{src:"".concat(x.base,"images/").concat(a.toLowerCase(),"/").concat(n.toLowerCase().replace("'","").replace(" ",""),".png"),alt:"Portrait of ".concat(t)}))),r.a.createElement("h1",{className:"card-header-title"},t),r.a.createElement("div",{className:"card-content"},r.a.createElement("div",{className:"level"},r.a.createElement("div",{className:"level-left"},r.a.createElement("img",{className:"level-item",src:"".concat(x.base,"images/trait/").concat(c.name,".png"),title:c.name,alt:c.name}),r.a.createElement("img",{className:"level-item",src:"".concat(x.base,"images/armor/").concat(l.name,".png"),title:l.name+" Armor",alt:l.name+" Armor"}),r.a.createElement("img",{className:"level-item",src:"".concat(x.base,"images/weapon/").concat(u.name,".png"),title:"Main hand: ".concat(u.name),alt:u.name}),"Empty"!==m.name&&r.a.createElement("img",{className:"level-item",src:"".concat(x.base,"images/weapon/").concat(m.name,".png"),title:"Off hand: ".concat(m.name),alt:m.name}))),Object.keys(h).map((function(e){return r.a.createElement("div",{key:e,className:"columns is-mobile"},r.a.createElement("div",{className:"column my-1 py-0"},e),r.a.createElement("div",{className:"column my-1 py-0"},h[e]))})),r.a.createElement("div",{className:"columns is-mobile"},r.a.createElement("div",{className:"column"},"Hp"),r.a.createElement("div",{className:"column"},d,"/",p))))};var ve=function(e){var t=e.mainHand,a=e.offHand,n=e.weapons,s=e.onChange,i=n.find((function(e){return e._id===t})),o=n.find((function(e){return e._id===a})),c=n.find((function(e){return"Empty"===e.name})),l=function(e,t){(s(e,t),"main_hand"===e)&&(2===n.find((function(e){return e._id===t})).hands&&s("off_hand",c._id))};return r.a.createElement(r.a.Fragment,null,i&&r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Weapons"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input ".concat(i.hands+o.hands===2?"is-success":"is-danger"),value:"".concat(i.hands+o.hands,"/2"),disabled:!0,readOnly:!0})),t.hands+a.hands<2&&r.a.createElement("p",{className:"help is-danger"},"You have unused hands!")),r.a.createElement(D,{name:"main_hand",label:"Main Hand",value:i&&i._id,list:n.filter((function(e){return"Empty"!==e.name})),onChange:l}),r.a.createElement(D,{name:"off_hand",label:"Off Hand",value:o&&o._id,list:n.filter((function(e){return i&&2===i.hands?"Empty"===e.name:e.hands<2&&"Empty"!==e.name})),onChange:l,disabled:i&&2===i.hands}))},be=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={title:"",buttonLabel:"Save",data:{_id:"",name:"",gender:"",race:"",physical:0,magical:0,leadership:0,trait:"",armor:"",main_hand:"",off_hand:"",current_hp:40},errors:{name:""},traits:[],armors:[],weapons:[]},e.schema=se.c().shape({name:se.e().matches(new RegExp(oe.regexes.toon),"ToonCard name must only contain letters, digits, or -_' and must be 3 to 50 characters long").required(),gender:se.e().required(),race:se.e().required(),physical:se.b().integer().required().min(0).max(4),magical:se.b().integer().required().min(0).max(4),leadership:se.b().integer().required().min(0).max(4),trait:se.e().required(),armor:se.e().required(),main_hand:se.e().required(),off_hand:se.e().required()}),e.genders=[{_id:"Male",name:"Male"},{_id:"Female",name:"Female"}],e.races=[{_id:"Elezen",name:"Elezen"},{_id:"Hyur",name:"Hyur"},{_id:"Miqo'te",name:"Miqo'te"},{_id:"Lalafell",name:"Lalafell"},{_id:"Roegadyn",name:"Roegadyn"},{_id:"Au Ra",name:"Au Ra"},{_id:"Hrothgar",name:"Hrothgar"},{_id:"Viera",name:"Viera"}],e}return Object(p.a)(a,[{key:"getStateReadyToon",value:function(e){return{_id:e._id,is_new:!1,name:e.name,gender:e.gender,race:e.race,physical:e.physical,magical:e.magical,leadership:e.leadership,trait:e.trait._id,armor:e.armor._id,main_hand:e.main_hand._id,off_hand:e.off_hand._id,current_hp:e.current_hp}}},{key:"fetchToon",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.match.params.id){e.next=7;break}return e.next=3,C.get(x.api+"toons/"+this.props.match.params.id);case 3:return t=e.sent,e.abrupt("return",this.getStateReadyToon(t));case 7:return e.abrupt("return",Promise.resolve({_id:"",is_new:!0,name:"",gender:"Female",race:"Miqo'te",physical:0,magical:0,leadership:0,trait:this.state.traits.find((function(e){return"Balanced"===e.name}))._id,armor:this.state.armors.find((function(e){return"None"===e.name}))._id,main_hand:this.state.weapons.find((function(e){return"Unarmed"===e.name}))._id,off_hand:this.state.weapons.find((function(e){return"Unarmed"===e.name}))._id,current_hp:40}));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={},e.next=4,C.get(x.api+"traits");case 4:return t.traits=e.sent,e.next=7,C.get(x.api+"armors");case 7:return t.armors=e.sent,e.next=10,C.get(x.api+"weapons");case 10:return t.weapons=e.sent,this.setState(t),e.t0=this,e.next=15,this.fetchToon();case 15:e.t1=e.sent,e.t2={},e.t3={data:e.t1,errors:e.t2},e.t0.setState.call(e.t0,e.t3),e.next=24;break;case 21:e.prev=21,e.t4=e.catch(0),console.error("Unexpected error occurred while trying to fetch Traits, Armors and Weapons in the Toon Editor",e.t4);case 24:case"end":return e.stop()}}),e,this,[[0,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(d.a)(l.a.mark((function e(t,a,n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.match.params.id===t.match.params.id){e.next=7;break}return e.t0=this,e.next=4,this.fetchToon();case 4:e.t1=e.sent,e.t2={data:e.t1},e.t0.setState.call(e.t0,e.t2);case 7:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"doSubmit",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state.data,e.prev=1,!t.is_new){e.next=10;break}return e.next=5,C.post("".concat(x.api,"toons/"),t);case 5:a=e.sent,this.setState({data:this.getStateReadyToon(a)}),a&&b.b.success("Created!"),e.next=15;break;case 10:return e.next=12,C.put("".concat(x.api,"toons/").concat(t._id),t);case 12:n=e.sent,this.setState({data:this.getStateReadyToon(n)}),n&&b.b.success("Saved!");case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),console.error(e.t0);case 20:case"end":return e.stop()}}),e,this,[[1,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.data,t=e._id,a=e.name,n=e.gender,s=e.race,i=e.physical,o=e.magical,c=e.leadership,l=e.trait,u=e.armor,m=e.main_hand,d=e.off_hand,h=e.current_hp,p=this.state.traits.find((function(e){return l?e._id===l:"Balanced"===e.name})),f=this.state.armors.find((function(e){return u?e._id===u:"None"===e.name})),g=this.state.weapons.find((function(e){return m?e._id===m:"Empty"===e.name})),v=this.state.weapons.find((function(e){return d?e._id===d:"Empty"===e.name}));return r.a.createElement("div",{className:"columns is-vcentered"},r.a.createElement("div",{className:"column"},ie.prototype.render.call(this)),r.a.createElement("div",{className:"column"},g&&r.a.createElement(ge,{_id:t,name:a,gender:n,race:s,physical:i,magical:o,leadership:c,trait:p,armor:f,main_hand:g,off_hand:v,current_hp:h})))}},{key:"renderBody",value:function(){var e=this,t=this.state.data,a=t.physical,n=t.magical,s=t.leadership;return r.a.createElement(r.a.Fragment,null,r.a.createElement(R,{type:"text",name:"name",value:this.state.data.name,onChange:this.handleChange,options:{placeholder:"Zename Ofzetoon..."},error:this.state.errors.name}),r.a.createElement(D,{name:"gender",value:this.state.data.gender,list:this.genders,onChange:this.handleChange}),r.a.createElement(D,{name:"race",value:this.state.data.race,list:this.races,options:{label:"Species"},onChange:this.handleChange}),r.a.createElement("div",{className:"field"},r.a.createElement("label",{className:"label"},"Attributes"),r.a.createElement("div",{className:"control"},r.a.createElement("input",{className:"input ".concat(a+n+s===6?"is-success":"is-danger"),value:"".concat(a+n+s,"/6"),disabled:!0,readOnly:!0})),a+n+s<6&&r.a.createElement("p",{className:"help is-danger"},"You have unused attribute points!")),r.a.createElement(fe,{name:"physical",value:a,onChange:this.handleChange,max:a+n+s}),r.a.createElement(fe,{name:"magical",value:n,onChange:this.handleChange,max:a+n+s}),r.a.createElement(fe,{name:"leadership",value:s,onChange:this.handleChange,max:a+n+s}),r.a.createElement(D,{name:"trait",value:this.state.data.trait,list:this.state.traits,onChange:this.handleChange}),r.a.createElement(D,{name:"armor",value:this.state.data.armor,list:this.state.armors,onChange:this.handleChange,constraint:function(t){return t.physical<=e.state.data.physical},constraintMessage:function(e){return"Physical of ".concat(e.physical," required to wear this")}}),r.a.createElement(ve,{mainHand:this.state.data.main_hand,offHand:this.state.data.off_hand,weapons:this.state.weapons,onChange:this.handleChange}))}}]),a}(ie);var ye=function(e){var t=e.toons;return r.a.createElement(r.a.Fragment,null,t.map((function(e){return r.a.createElement(ge,Object.assign({key:e._id},e))})))},Ee=function(e){Object(f.a)(a,e);var t=Object(g.a)(a);function a(){var e;Object(h.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={stream:null,user:null,allToons:[],myToons:[],fights:[]},e}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t,a,n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t={}).user=T.getCurrentUser(),e.next=4,C.get(x.api+"fights");case 4:return t.fights=e.sent,e.next=7,C.get(x.api+"toons");case 7:if(t.allToons=e.sent,!t.user){e.next=13;break}return e.next=11,C.get(x.api+"users/me/toons");case 11:a=e.sent,t.myToons=a.map((function(e){return e._id}));case 13:t.stream=new EventSource(x.api+"events"),t.stream.onopen=function(){console.info("App is listening to server events")},t.stream.addEventListener("fight-created",(function(e){try{var t=JSON.parse(e.data).fight,a=[].concat(Object(m.a)(n.state.fights),[t]);n.setState({fights:a}),b.b.info("A DM just added a fight")}catch(e){console.error("Unexpected error while parsing created fight data:",e)}})),t.stream.addEventListener("fight-delete",(function(e){try{var t=JSON.parse(e.data),a=t.fights,r=t.toons;n.setState({fights:a,allToons:r}),b.b.info("A DM just concluded a fight")}catch(e){console.error("Unexpected error while parsing deleted fight data:",e)}})),t.stream.addEventListener("fight-advance",(function(e){console.log("Got a fight-advance event");try{var t=JSON.parse(e.data),a=t.fight,r=t.toons,s=Object(m.a)(n.state.fights),i=s.findIndex((function(e){return e._id===a._id}));s[i]=a;var o,c=Object(m.a)(n.state.allToons),l=Object(u.a)(r);try{var d=function(){var e=o.value,t=c.findIndex((function(t){return t._id===e._id}));c[t]=e};for(l.s();!(o=l.n()).done;)d()}catch(h){l.e(h)}finally{l.f()}n.setState({fights:s,allToons:c})}catch(e){console.error("Unexpected error while parsing advancing fight data:",e)}})),t.stream.addEventListener("action-taken",(function(e){console.log("Got an action-taken event");try{var t=JSON.parse(e.data),a=Object(m.a)(n.state.allToons),r=Object(m.a)(n.state.fights);if(t.toons){var s,i=Object(u.a)(t.toons);try{var o=function(){var e=s.value,t=a.findIndex((function(t){return t._id===e._id}));a[t]=e};for(i.s();!(s=i.n()).done;)o()}catch(l){i.e(l)}finally{i.f()}}if(t.fight){var c=r.findIndex((function(e){return e._id===t.fight._id}));r[c]=t.fight}n.setState({allToons:a,fights:r})}catch(e){console.error("Unexpected error while parsing action data:",e)}})),t.stream.addEventListener("mob-acted",(function(e){console.log("Got a mob-acted event");try{var t=JSON.parse(e.data),a=Object(m.a)(n.state.fights);if(t.fight){var r=a.findIndex((function(e){return e._id===t.fight._id}));a[r]=t.fight}n.setState({fights:a})}catch(e){console.error("Unexpected error while parsing mob action data:",e)}})),t.stream.addEventListener("toon-created",(function(e){console.log("Got a toon-created event");try{var t=JSON.parse(e.data).toon,a={};a.allToons=[].concat(Object(m.a)(n.state.allToons),[t]),n.state.user&&t.user===n.state.user._id&&(a.myToons=[].concat(Object(m.a)(n.state.myToons),[t._id])),n.setState(a)}catch(e){console.error("Unexpected error while parsing toon created data:",e)}})),t.stream.addEventListener("toon-updated",(function(e){console.log("Got a toon-updated event");try{var t=JSON.parse(e.data).toon,a=Object(m.a)(n.state.allToons),r=a.findIndex((function(e){return e._id===t._id}));a[r]=t,n.setState({allToons:a})}catch(e){console.error("Unexpected error while parsing toon updated data:",e)}})),this.setState(t);case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.state.stream&&this.state.stream.close()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"App"},r.a.createElement(b.a,null),r.a.createElement(q,{user:this.state.user,fights:this.state.fights,toons:this.state.allToons.filter((function(t){return e.state.myToons.includes(t._id)})),stream:this.state.stream}),r.a.createElement("div",{className:"main container"},r.a.createElement(v.d,null,r.a.createElement(v.b,{path:"/my-toon/:id?",component:be}),r.a.createElement(v.b,{path:"/all-toons",render:function(t){return r.a.createElement(ye,Object.assign({toons:e.state.allToons},t))}}),r.a.createElement(v.b,{path:"/fight/:id",render:function(t){return r.a.createElement(ne,Object.assign({user:e.state.user,fights:e.state.fights,toons:e.state.allToons,stream:e.state.stream},t))}}),r.a.createElement(v.b,{path:"/fight",render:function(t){return r.a.createElement(me,Object.assign({toons:e.state.allToons},t))}}),r.a.createElement(v.b,{path:"/register",component:de}),r.a.createElement(v.b,{path:"/login",component:he}),r.a.createElement(v.b,{path:"/logout",component:pe}),r.a.createElement(v.a,{to:"/all-toons"}))))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));String.prototype.capitalize=function(){return this[0].toUpperCase()+this.slice(1)},Array.prototype.sortWithFunction=function(e,t){var a;a=t&&"ascending"===t?function(t,a){return!e(t,a)}:function(t,a){return e(t,a)};for(var n=0;n<this.length-1;n++)for(var r=0;r<this.length-1-n;r++)if(a(this[r],this[r+1])){var s=this[r];this[r]=this[r+1],this[r+1]=s}return this},i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(o.a,null,r.a.createElement(Ee,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},21:function(e){e.exports=JSON.parse('{"regexes":{"toon":"^[a-zA-Z0-9\\\\-_\' ]{3,50}$","fight":"^[a-zA-Z0-9\\\\-_\' \\\\(\\\\)]{3,200}$","password":"^.{5,25}$"}}')},74:function(e,t,a){e.exports=a(127)},79:function(e,t,a){},83:function(e,t,a){}},[[74,1,2]]]);
//# sourceMappingURL=main.350bb5a5.chunk.js.map